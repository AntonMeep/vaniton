pragma Ada_2012;

with Cells; use Cells;

package body Wallets is
   Wallet_Code_Simple_R1 : constant Cell :=
     From_BoC
       ("B5EE9C72410101010044000084FF0020DDA4F260810200D71820D70B1FED44D0D31" &
        "FD3FFD15112BAF2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB" &
        "00DED1A4C8CB1FCBFFC9ED5441FDF089");
   Wallet_Code_Simple_R2 : constant Cell :=
     From_BoC
       ("B5EE9C724101010100530000A2FF0020DD2082014C97BA9730ED44D0D70B1FE0A4F" &
        "260810200D71820D70B1FED44D0D31FD3FFD15112BAF2A122F901541044F910F2A2" &
        "F80001D31F3120D74A96D307D402FB00DED1A4C8CB1FCBFFC9ED54D0E2786F");

   Wallet_Code_Simple_R3 : constant Cell :=
     From_BoC
       ("B5EE9C7241010101005F0000BAFF0020DD2082014C97BA218201339CBAB19C71B0E" &
        "D44D0D31FD70BFFE304E0A4F260810200D71820D70B1FED44D0D31FD3FFD15112BA" &
        "F2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB00DED1A4C8CB1" &
        "FCBFFC9ED54B5B86E42");

   Wallet_Code_V2_R1 : constant Cell :=
     From_BoC
       ("B5EE9C724101010100570000AAFF0020DD2082014C97BA9730ED44D0D70B1FE0A4F" &
        "2608308D71820D31FD31F01F823BBF263ED44D0D31FD3FFD15131BAF2A103F90154" &
        "1042F910F2A2F800029320D74A96D307D402FB00E8D1A4C8CB1FCBFFC9ED54A1370" &
        "BB6");

   Wallet_Code_V2_R2 : constant Cell :=
     From_BoC
       ("B5EE9C724101010100630000C2FF0020DD2082014C97BA218201339CBAB19C71B0E" &
        "D44D0D31FD70BFFE304E0A4F2608308D71820D31FD31F01F823BBF263ED44D0D31F" &
        "D3FFD15131BAF2A103F901541042F910F2A2F800029320D74A96D307D402FB00E8D" &
        "1A4C8CB1FCBFFC9ED54044CD7A1");

   Wallet_Code_V3_R1 : constant Cell :=
     From_BoC
       ("B5EE9C724101010100620000C0FF0020DD2082014C97BA9730ED44D0D70B1FE0A4F" &
        "2608308D71820D31FD31FD31FF82313BBF263ED44D0D31FD31FD3FFD15132BAF2A1" &
        "5144BAF2A204F901541055F910F2A3F8009320D74A96D307D402FB00E8D101A4C8C" &
        "B1FCB1FCBFFC9ED543FBE6EE0");

   Wallet_Code_V3_R2 : constant Cell :=
     From_BoC
       ("B5EE9C724101010100710000DEFF0020DD2082014C97BA218201339CBAB19F71B0E" &
        "D44D0D31FD31F31D70BFFE304E0A4F2608308D71820D31FD31FD31FF82313BBF263" &
        "ED44D0D31FD31FD3FFD15132BAF2A15144BAF2A204F901541055F910F2A3F800932" &
        "0D74A96D307D402FB00E8D101A4C8CB1FCB1FCBFFC9ED5410BD6DAD");

   Wallet_Code_V4_R1 : constant Cell :=
     From_BoC
       ("B5EE9C72410215010002F5000114FF00F4A413F4BCF2C80B0102012002030201480" &
        "40504F8F28308D71820D31FD31FD31F02F823BBF263ED44D0D31FD31FD3FFF404D1" &
        "5143BAF2A15151BAF2A205F901541064F910F2A3F80024A4C8CB1F5240CB1F5230C" &
        "BFF5210F400C9ED54F80F01D30721C0009F6C519320D74A96D307D402FB00E830E0" &
        "21C001E30021C002E30001C0039130E30D03A4C8CB1F12CB1FCBFF1112131403EED" &
        "001D0D3030171B0915BE021D749C120915BE001D31F218210706C7567BD22821062" &
        "6C6E63BDB022821064737472BDB0925F03E002FA403020FA4401C8CA07CBFFC9D0E" &
        "D44D0810140D721F404305C810108F40A6FA131B3925F05E004D33FC8258210706C" &
        "7567BA9131E30D248210626C6E63BAE30004060708020120090A005001FA00F4043" &
        "08210706C7567831EB17080185005CB0527CF165003FA02F40012CB69CB1F5210CB" &
        "3F0052F8276F228210626C6E63831EB17080185005CB0527CF1624FA0214CB6A13C" &
        "B1F5230CB3F01FA02F4000092821064737472BA8E3504810108F45930ED44D08101" &
        "40D720C801CF16F400C9ED54821064737472831EB17080185004CB0558CF1622FA0" &
        "212CB6ACB1FCB3F9410345F04E2C98040FB000201200B0C0059BD242B6F6A268408" &
        "0A06B90FA0218470D4080847A4937D29910CE6903E9FF9837812801B78101489871" &
        "59F31840201580D0E0011B8C97ED44D0D70B1F8003DB29DFB513420405035C87D01" &
        "0C00B23281F2FFF274006040423D029BE84C600201200F100019ADCE76A26840206" &
        "B90EB85FFC00019AF1DF6A26840106B90EB858FC0006ED207FA00D4D422F90005C8" &
        "CA0715CBFFC9D077748018C8CB05CB0222CF165005FA0214CB6B12CCCCC971FB00C" &
        "84014810108F451F2A702006C810108D718C8542025810108F451F2A782106E6F74" &
        "6570748018C8CB05CB025004CF16821005F5E100FA0213CB6A12CB1FC971FB00020" &
        "072810108D718305202810108F459F2A7F82582106473747270748018C8CB05CB02" &
        "5005CF16821005F5E100FA0214CB6A13CB1F12CB3FC973FB00000AF400C9ED5446A" &
        "9F34F");

   Wallet_Code_V4_R2 : constant Cell :=
     From_BoC
       ("B5EE9C72410214010002D4000114FF00F4A413F4BCF2C80B0102012002030201480" &
        "40504F8F28308D71820D31FD31FD31F02F823BBF264ED44D0D31FD31FD3FFF404D1" &
        "5143BAF2A15151BAF2A205F901541064F910F2A3F80024A4C8CB1F5240CB1F5230C" &
        "BFF5210F400C9ED54F80F01D30721C0009F6C519320D74A96D307D402FB00E830E0" &
        "21C001E30021C002E30001C0039130E30D03A4C8CB1F12CB1FCBFF1011121302E6D" &
        "001D0D3032171B0925F04E022D749C120925F04E002D31F218210706C7567BD2282" &
        "1064737472BDB0925F05E003FA403020FA4401C8CA07CBFFC9D0ED44D0810140D72" &
        "1F404305C810108F40A6FA131B3925F07E005D33FC8258210706C7567BA923830E3" &
        "0D03821064737472BA925F06E30D06070201200809007801FA00F40430F8276F223" &
        "0500AA121BEF2E0508210706C7567831EB17080185004CB0526CF1658FA0219F400" &
        "CB6917CB1F5260CB3F20C98040FB0006008A5004810108F45930ED44D0810140D72" &
        "0C801CF16F400C9ED540172B08E23821064737472831EB17080185005CB055003CF" &
        "1623FA0213CB6ACB1FCB3FC98040FB00925F03E20201200A0B0059BD242B6F6A268" &
        "4080A06B90FA0218470D4080847A4937D29910CE6903E9FF9837812801B78101489" &
        "87159F31840201580C0D0011B8C97ED44D0D70B1F8003DB29DFB513420405035C87" &
        "D010C00B23281F2FFF274006040423D029BE84C600201200E0F0019ADCE76A26840" &
        "206B90EB85FFC00019AF1DF6A26840106B90EB858FC0006ED207FA00D4D422F9000" &
        "5C8CA0715CBFFC9D077748018C8CB05CB0222CF165005FA0214CB6B12CCCCC973FB" &
        "00C84014810108F451F2A7020070810108D718FA00D33FC8542047810108F451F2A" &
        "782106E6F746570748018C8CB05CB025006CF165004FA0214CB6A12CB1FCB3FC973" &
        "FB0002006C810108D718FA00D33F305224810108F459F2A78210647374727074801" &
        "8C8CB05CB025005CF165003FA0213CB6ACB1F12CB3FC973FB00000AF400C9ED5469" &
        "6225E5");

   function Get_Wallet_Address
     (Public_Key : Byte_Array; Workchain : Integer_8 := 0;
      Kind       : Wallet_Kind := V3_R2; Test_Only : Boolean := False;
      Bounceable : Boolean     := True) return Address
   is
      Result : Address;

      Code : aliased Cell;
      Data : aliased Cell := Empty_Cell;

      State_Init       : Cell                        := Empty_Cell;
      State_Init_Array : constant Bit_Array (1 .. 5) :=
        (False, -- split depth
         False, -- tick tock
         True, -- code
         True, -- data
         False -- library
      );
   begin
      case Kind is
         when Simple_R1 =>
            Code := Wallet_Code_Simple_R1;
         when Simple_R2 =>
            Code := Wallet_Code_Simple_R2;
         when Simple_R3 =>
            Code := Wallet_Code_Simple_R3;
         when V2_R1 =>
            Code := Wallet_Code_V2_R1;
         when V2_R2 =>
            Code := Wallet_Code_V2_R2;
         when V3_R1 =>
            Code := Wallet_Code_V3_R1;
         when V3_R2 =>
            Code := Wallet_Code_V3_R2;
         when V4_R1 =>
            Code := Wallet_Code_V4_R1;
         when V4_R2 =>
            Code := Wallet_Code_V4_R2;
      end case;

      case Kind is
         when Simple_R1 | Simple_R2 | Simple_R3 | V2_R1 | V2_R2 =>
            Write (Data, Unsigned_32 (0));
            Write (Data, Public_Key);
         when V3_R1 | V3_R2 =>
            Data := Empty_Cell;
            Write (Data, Unsigned_32 (0));
            Write (Data, Unsigned_32 (698_983_191 + Integer (Workchain)));
            Write (Data, Public_Key);
         when V4_R1 | V4_R2 =>
            Write (Data, Unsigned_32 (0));
            Write (Data, Unsigned_32 (698_983_191 + Integer (Workchain)));
            Write (Data, Public_Key);
            Write (Data, False);
      end case;

      Write (State_Init, State_Init_Array);
      Append_Reference (State_Init, Code);
      Append_Reference (State_Init, Data);

      Result := Create (Test_Only, Bounceable, Workchain, Hash (State_Init));

      return Result;
   end Get_Wallet_Address;
end Wallets;
